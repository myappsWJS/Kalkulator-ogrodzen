<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Kalkulator ogrodzeń</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h1 { margin-bottom: 20px; }
    label { display: inline-block; width: 120px; margin-top: 8px; }
    input, select { margin-bottom: 10px; padding: 4px; }
    button { padding: 8px 16px; margin-top: 12px; cursor: pointer; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; max-width: 800px; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; }
    th { background-color: #f4f4f4; }
    #wynik { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Kalkulator ogrodzeń</h1>

  <form id="formularz" onsubmit="event.preventDefault(); obliczKoszt();">
    <label for="wysokosc">Wysokość:</label>
    <select id="wysokosc" required>
      <option value="1">1 m</option>
      <option value="1.2">1.2 m</option>
      <option value="1.5">1.5 m</option>
    </select><br>

    <label for="dlugosc">Długość [m]:</label>
    <input type="number" id="dlugosc" step="0.1" required><br>

    <label for="narozniki">Narożniki [szt.]:</label>
    <input type="number" id="narozniki" required><br>

    <label for="kolor">Kolor:</label>
    <select id="kolor">
      <option value="">Dowolny</option>
      <option value="ZIELONY">Zielony</option>
      <option value="SZARY">Szary</option>
      <option value="CZARNY">Czarny</option>
    </select><br>

    <button type="submit">Oblicz koszt</button>
  </form>

  <div id="wynik"></div>

  <script>
    async function obliczKoszt() {
      const body = {
        wysokosc: document.getElementById("wysokosc").value,
        dlugosc: parseFloat(document.getElementById("dlugosc").value) || 0,
        narozniki: parseInt(document.getElementById("narozniki").value) || 0,
        kolor: document.getElementById("kolor").value
      };

      document.getElementById("wynik").innerHTML = "<p>Obliczanie...</p>";

      const res = await fetch("/api/kalkulator", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      if (!res.ok) {
        document.getElementById("wynik").innerHTML = "<p>Błąd obliczeń.</p>";
        return;
      }

      const data = await res.json();

      let html = "<table><tr><th>Ref</th><th>Nazwa</th><th>Cena [zł]</th><th>Ilość</th><th>Wartość [zł]</th></tr>";
      data.produkty.forEach(p => {
        html += `<tr>
          <td>${p.ref}</td>
          <td>${p.nazwa}</td>
          <td>${p.cena}</td>
          <td>${p.qty}</td>
          <td>${p.wartosc}</td>
        </tr>`;
      });
      html += `<tr><td colspan="4"><b>Suma</b></td><td><b>${data.suma}</b></td></tr></table>`;

      document.getElementById("wynik").innerHTML = html;
    }
  </script>
</body>
</html>
